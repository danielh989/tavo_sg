function crear_orden(){var a={id_mesa:"",productos:[]},b={},c=($(".modal-header"),$(".modal-body")),d=$(".modal-footer");$("#myModal").on("hidden.bs.modal",function(){a={id_mesa:"",productos:[]}}),$(".table-add, .pedido-opciones .table-add").on("click",function(){var a=($(this),"/tavo_sg/mesas/libres"),b="get",e={};$.ajax({url:a,type:b,data:e,success:function(a){c.html(""),d.html(""),$.get("/tavo_sg/assets/templates/mesas_disponibles.mst",function(b){console.log(b),$.each(a,function(d,e){c.append(Mustache.render(b,a[d]))})})}})}),$(c).on("click",".mesa-libre",function(){var e=$(this),f="categorias/getJSON",g="post",h={};a.id_mesa=e.data("id"),$.ajax({url:f,type:g,data:h,success:function(a){b=a,c.html(""),d.html(""),$.get("assets/templates/btn-completar.mst",function(a){d.append(Mustache.render(a))}),$.get("assets/templates/categorias.mst",function(b){$.each(a,function(d,e){c.append(Mustache.render(b,a[d]))})})}})}),$(".modal-body").on("click",".categoria",function(){var a=($(this),"productos/getJSON"),b="post",d={};d.id_cat=$(this).data("id"),$.ajax({url:a,type:b,data:d,success:function(a){c.html(""),$.get("assets/templates/back-btn.mst",function(a){c.append(Mustache.render(a))}),$.get("assets/templates/productos.mst",function(b){$.each(a,function(d,e){c.append(Mustache.render(b,a[d]))})})}})}),c.on("click",".btn-agregar",function(){var b=$(this),c=0,d=b.closest(".number-wrapper").find(".cantidad"),e=parseInt(d.text());d.html(""),""==a.productos?(a.productos.push({id:b.data("id"),cantidad:"1"}),d.append("1")):($.each(a.productos,function(f,g){a.productos[f].id===b.data("id")&&(a.productos[f].cantidad=parseInt(a.productos[f].cantidad)+1,a.productos[f].id=b.data("id"),d.append(e+1),c=1)}),0==c&&(a.productos.push({id:b.data("id"),cantidad:"1"}),d.append("1")))}),c.on("click",".btn-atras",function(){var d=$.merge(b,a);c.html(""),$.get("assets/templates/categorias.mst",function(a){$.each(b,function(b,e){c.append(Mustache.render(a,d[b]))})})}),d.on("click",".btn-completar",function(){var b="post",c="pedidos/add",d=a;$.ajax({url:c,type:b,data:d,success:function(a){window.location="http://localhost/tavo_sg/"}})})}function formatoPago(){function a(){c.maskMoney("mask"),b.maskMoney("mask")}var b=$("#efectivo"),c=$("#debito"),d=$("#total_form").data("total"),e=$("#porc_des").data("descuento");b.maskMoney({thousands:".",decimal:",",allowZero:!1,suffix:" Bs.F"}),c.maskMoney({thousands:".",decimal:",",allowZero:!1,suffix:" Bs.F"}),$("#descuento").change(function(){this.checked?(d=parseFloat(d)-parseFloat(d)*(parseFloat(e)/100),d=RoundToDecimal(d,2),total_text=d.toString().split("."),$("#total_0").text(total_text[0]),$("#total_1").text("."+total_text[1]),c.val("0.00"),b.val("0.00"),a(),$('#pay-form input[type="radio"]').prop("checked",!1)):(d=$("#total_form").data("total"),d=RoundToDecimal(d,2),total_text=d.toString().split("."),$("#total_0").text(total_text[0]),$("#total_1").text("."+total_text[1]),c.val("0.00"),b.val("0.00"),a(),$('#pay-form input[type="radio"]').prop("checked",!1))}),a(),$("#efectivo").keyup(function(){valor=$(this).maskMoney("unmasked")[0],valor=RoundToDecimal(valor,2),parseFloat(valor)>parseFloat(d)&&($(this).val(d),valor=d);var b=d-valor;c.val(RoundToDecimal(b,2)),a(),$('#pay-form input[type="radio"]').prop("checked",!1)}),$("#debito").keyup(function(){valor=$(this).maskMoney("unmasked")[0],valor=RoundToDecimal(valor,2),parseFloat(valor)>parseFloat(d)&&($(this).val(d),valor=d);var c=parseFloat(d)-parseFloat(valor);b.val(RoundToDecimal(c,2)),a(),$('#pay-form input[type="radio"]').prop("checked",!1)}),$("#pay-form").submit(function(e){var f=this;return e.preventDefault(),b.val(b.maskMoney("unmasked")[0]),c.val(c.maskMoney("unmasked")[0]),pago=parseFloat(b.val())+parseFloat(c.val()),pago=RoundToDecimal(pago,2),parseFloat(pago)<parseFloat(d)?(a(),alert("No se ha completado el pago de la orden")):f.submit(),!1}),$("input[type=radio]").on("click",function(){var e=$(this).attr("value"),f=$(".modal-footer button[type=submit]");switch(e){case"efectivo":b.val(RoundToDecimal(d,2)),c.val("0.00"),b.trigger("focus"),c.trigger("focus"),f.trigger("focus"),a();break;case"debito":c.val(RoundToDecimal(d,2)),b.val("0.00"),c.trigger("focus"),b.trigger("focus"),f.trigger("focus"),a()}})}function RoundToDecimal(a,b){var c=new String(1..toFixed(b));c=c.substr(2);var d=parseFloat("1"+c),e=parseFloat("."+c+"01");return 10*a*d%10>=5&&(a+=e),(Math.round(a*d)/d).toFixed(b)}function gestionarCategorias(){$(".agregar-categoria").on("click",function(){var a=$(this),b=a.data("id");nombre=a.find("h4").data("nombre"),$("input[name=id]").val(b),$("input[name=nombre]").val(nombre),$("span.error").empty()}),$(".eliminar_categoria").on("click",function(){var a=$(this).closest(".agregar-categoria"),b=a.data("id"),c={};c.id_categoria=b,console.log(b),$.ajax({type:"POST",url:"categorias/delete",data:c,success:function(b){1451==$.parseJSON(b).code?alert("No se puede eliminar la categoria porque pertenece a un pedido"):(a.remove(),location.reload())}})}),$("#form-categoria").submit(function(a){a.preventDefault();var b=$("#form-categoria"),c=b.attr("method"),d=b.attr("action"),e=b.serialize();$.ajax({type:c,url:d,data:e,success:function(a){1062==$.parseJSON(a).code?$("span.error").empty().append("Ya existe una categoria con ese nombre"):location.reload()}})})}function gestionarMesas(){$(".agregar-mesa").on("click",function(){var a=$(this).find("div"),b=a.find("p").data("id");numero=a.find("h2").data("numero"),nombre=a.find("h4").data("nombre"),$("input[name=id]").val(b),$("input[name=nombre]").val(nombre),$("input[name=numero]").val(numero),$("span.error").empty()}),$(".eliminar_mesa").on("click",function(){var a=$(this).closest("div"),b=a.find("p").data("id");$.ajax({type:"POST",url:"mesas/delete",data:{id_mesa:b},success:function(b){1451==$.parseJSON(b).code?alert("No se puede eliminar la mesa porque pertenece a un pedido"):a.closest("a").remove()}})}),$("#form-mesa").submit(function(a){a.preventDefault();var b=$("#form-mesa"),c=b.attr("method"),d=b.attr("action"),e=b.serialize();$.ajax({type:c,url:d,data:e,success:function(a){1062==$.parseJSON(a).code?$("span.error").empty().append("El nombre o numero de mesa ya existe"):location.reload()}})})}function gestionarPedidos(){$(".btn-eliminar").on("click",function(){var a="post",b="/tavo_sg/Productosxpedido/delete",c={};c.id_pedido=$(this).data("pedido"),c.id_producto=$(this).data("producto"),$.ajax({type:a,url:b,data:c,success:function(a){location.reload()}})}),$(".btn-eliminar-devuelto").on("click",function(){var a="post",b="/tavo_sg/Productosxpedido/deleteDevuelto",c={};c.id_pedido=$(this).data("pedido"),c.id_producto=$(this).data("producto"),$.ajax({type:a,url:b,data:c,success:function(a){location.reload()}})}),$(".btn-devolver").on("click",function(){var a="post",b="/tavo_sg/Productosxpedido/devolver",c={};c.id_pedido=$(this).data("pedido"),c.id_producto=$(this).data("producto"),$.ajax({type:a,url:b,data:c,success:function(a){location.reload()}})})}function gestionarProductos(){$(".btn-agregar").on("click",function(){getCategorias("#id_cat",0),$("input").val(""),$("textarea").val("")}),$(".btn-guardar").on("click",function(){var a=$("form#producto"),b=a.attr("method"),c=a.attr("action"),d=a.serialize();$.ajax({type:b,url:c,data:d,success:function(a){a.st?location.reload():$("span.error").append("Opps! Ocurrio un error, intentalo nuevamente.")}})}),$(".table tbody .btn-editar").on("click",function(){var a=$(this).closest("tr"),b=a.data("id-producto"),c=a.find(".categoria").attr("data-idcat");$("input[name=id]").val(b),$("input[name=nombre]").val(a.find(".nombre").text()),$("input[name=precio]").val(a.find(".precio").text()),$("textarea[name=descripcion]").val(a.find(".descripcion").text()),getCategorias("#id_cat",1,c)}),$(".table tbody .btn-eliminar").on("click",function(){var a=$(this).closest("tr"),b=a.data("id-producto");$("#eliminarProducto a").attr("href","productos/delete/"+b)})}function getCategorias(a,b,c){var d="post",e="/tavo_sg/categorias/getJSON",f={};$.ajax({type:d,url:e,data:f,success:function(d){sel=$(a),sel.empty(),sel.append('<option value="0">Seleccionar...</option>'),$.each(d,function(a,b){sel.append('<option value="'+d[a].id+'">'+d[a].nombre+"</option>")}),1==b&&sel.val(c)}})}